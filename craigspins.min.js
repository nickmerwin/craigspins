(function(){var i=Math.floor($(window).width()/232);$(window).resize(function(){$("body").css({paddingLeft:($(window).width()-232*i)/2})});var C=$("body").html(),e=JSON.parse(localStorage.getItem("likes")||"[]");window.likes=e;$("body").keydown(function(a){g&&(37==a.keyCode?(a=f.indexOf(g)-1,0>a&&(a=f.length-1),o(f[a])):39==a.keyCode?(a=f.indexOf(g)+1,a>f.length&&(a=0),o(f[a])):27==a.keyCode&&m.click())});var k=$("<form/>",{id:"qForm"}),d=$("<input/>",{id:"q"}).css({cssFloat:"left",width:183,border:"1px solid", lineHeight:1.3,boxShadow:"0 1px #fff, inset 0 1px rgba(34,25,25,0.05)","-moz-box-shadow":"0 1px #fff, inset 0 1px rgba(34,25,25,0.05)","-webkit-box-shadow":"0 1px #fff, inset 0 1px rgba(34,25,25,0.05)",fontSize:13,borderColor:"#C2C0C0 #CCCACA #D1CFCF",padding:5,backgroundColor:"#FAF7F7",margin:0}),l=$("<a/>",{id:"qBtn",href:"#"}).css({cssFloat:"left",marginLeft:-1,padding:"7px 7px 2px",minHeight:17,border:"1px solid",boxShadow:"0 1px rgba(255,255,255,0.9), inset 0 0 2px rgba(255,255,255,0.75)","-moz-box-shadow":"0 1px rgba(255,255,255,0.9), inset 0 0 2px rgba(255,255,255,0.75)", "-webkit-box-shadow":"0 1px rgba(255,255,255,0.9), inset 0 0 2px rgba(255,255,255,0.75)",borderColor:"#C2C0C0 #CCCACA #D1CFCF"}).append($("<img/>",{src:"http://passets-cdn.pinterest.com/images/search.gif"})),d=$("<div/>",{id:"qWr"}).css({cssFloat:"left",margin:"8px 0 0",paddingLeft:15}).append(k.append(d).append(l)),q=$("<div/>",{id:"logo"}).css({position:"absolute",marginLeft:-50,left:"50%",top:7,cursor:"pointer"}).click(function(){for(var a=0;a<i;a++)j[a].html("");for(a=0;a<f.length;a++)p(f[a])}).append($("<img/>", {src:"http://lemurheavy.com/images/craigspin/logo.png"})),D=$("<div/>",{href:"javascript://"}).css({cssFloat:"right",margin:"8px 0 0",paddingRight:15,cursor:"pointer"}).html("Likes (n)").click(function(){for(var a=0;a<i;a++)j[a].html("");for(a=0;a<e.length;a++)p(e[a]);s=!0}),d=$("<div/>",{id:"nav"}).css({position:"fixed",height:44,top:0,left:0,width:"100%",backgroundColor:"#FAF7F7",boxShadow:"inset 0 1px #fff, 0 1px 3px rgba(34,25,25,0.4)",zIndex:103,"-webkit-box-shadow":"inset 0 1px #fff, 0 1px 3px rgba(34,25,25,0.4)", "-moz-box-shadow":"inset 0 1px #fff, 0 1px 2px rgba(34,25,25,0.4)"}).append(d).append(q).append(D),h=$("<div/>",{style:"-moz-box-shadow: 0 1px 7px rgba(34,25,25,0.4); -webkit-box-shadow: 0 1px 7px rgba(34,25,25,0.4); box-shadow: 0 1px 7px rgba(34,25,25,0.4);"}).css({position:"absolute",top:$(window).scrollTop()+30,left:"10%",backgroundColor:"white",width:650,zIndex:1001}).hide(),n=$("<div/>").css({padding:20,fontWeight:"bold",fontSize:14,borderBottom:"1px solid #D1CDCD"});h.append(n);q=$("<button/>").html("Like").click(function(){t(g)? (e.splice(e.indexOf(g),1),$(this).html("Like")):(e.push(g),$(this).html("Unlike"));localStorage.setItem("likes",JSON.stringify(e));return!1});h.append(q);var u=$("<div/>").css({padding:20});h.append(u);var m=$("<div/>").css({position:"fixed",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(255, 255, 255, 0.93)",zIndex:1E3}).hide();m.click(function(){m.hide();h.hide();g=null});$("html").css({background:'url("http://lemurheavy.com/images/craigspin/paper.jpg")'});d=$("body").css({margin:0, fontFamily:"'helvetica neue', arial, sans-serif",fontSize:"11px",background:"transparent"}).html($("<div/>",{id:"wr",style:"padding:60px 0 0; width:100%;"})).append($("<div/>",{id:"parser"}).css({display:"none"})).append(d);d.append(h);d.append(m);$("#q").focus(function(){$(this).css({backgroundColor:"#fff"})}).blur(function(){$(this).css({backgroundColor:"#FAF7F7"})});var t=function(a){for(var b=0;b<e.length;b++)if(e[b].id==a.id)return!0;return!1},d=function(){try{for(var a=$("#q").val(),b=0;b<i;b++)j[b].html(""); v=0;w=a;x(a,0);return!1}catch(c){return console.log(c),!1}};k.submit(d);l.click(d);$("body").css({paddingLeft:($(window).width()-232*i)/2});for(var j=[],k=0;k<i;k++)l=$("<div/>").css({width:222,cssFloat:"left",marginLeft:10}),0==k&&l.css({marginLeft:0}),j.push(l),$("#wr").append(l);$("#wr").append($("<div/>").css({clear:"both",cssFloat:"none"}));var s=!1,v=0,w=(window.location.search.match(/query=(.*?)(&|$)/)||[])[1],E=window.location.pathname.match(/(\w{3})\/?$/)[1],x=function(a,b){console.log("loadPage: "+ a);$.get("/search/"+E+"?query="+(a||"")+"&s="+100*b,function(a){y(a)||(z=!0);r=!1})},z=!1,r=!1;$(window).scroll(function(){!r&&(!z&&$(window).scrollTop()+$(window).height()>$("#wr").height()-$(window).height())&&(s||(r=!0,x(w,++v)))});var y=function(a){console.log("parsing!");count=0;$("#parser").html(a).find("span.i").add("span.ih").add("span.p").each(function(){var a=$(this).parents("p").find("a");(id=this.id.match(/images:(.*?)$/))?A("http://images.craigslist.org/"+id[1],a):$.get(a[0].href,function(c){(c= $(c).find("img").attr("src"))&&c.match(/images\.craigslist\.org/)&&A(c,a)});count++});return 0<count},f=[],g=null,A=function(a,b){var c=b.parents("p").html();c&&(c={id:b[0].href.match(/\d{6,}/)[0],src:a,href:b[0].href,title:b[0].innerHTML,section:b[1]&&b[1].innerHTML,sectionHref:b[1]&&b[1].href,price:(c.match(/(\$.*?)</)||[])[1],location:(c.match(/\((.*?)\)/)||[])[1]},f.push(c),p(c))},p=function(a){var b=$("<div/>",{style:"padding:15px 15px 0; margin: 0 0 10px; overflow: hidden; background-color:#fff; -moz-box-shadow: 0 1px 2px rgba(34,25,25,0.4); -webkit-box-shadow: 0 1px 3px rgba(34,25,25,0.4); box-shadow: 0 1px 3px rgba(34,25,25,0.4);"}).append($("<a/>", {href:a.href,target:"_blank"}).append($("<img/>",{src:a.src,style:"width:192px"}))).append($("<div/>").css({margin:"10px 0"}).html($("<a/>",{href:a.href,target:"_blank"}).css({color:"#000",textDecoration:"none"}).html("<b>"+(a.price||"")+"</b> "+a.title.substr(0,20)))).append($("<div/>").css({padding:10,margin:"0 -15px",backgroundColor:"#eee"}).html($("<a/>",{href:a.sectionHref,target:"_blank"}).css({color:"#8C7E7E",fontWeight:"bold",textTransform:"capitalize",textDecoration:"none"}).html(B(a)))); b.click(function(){return o(a)});for(var c=j[0],d=0;d<i;d++)j[d].height()<c.height()&&(c=j[d]);c.append(b)},B=function(a){return $("<a/>",{href:a.sectionHref,target:"_blank"}).css({color:"#8C7E7E",fontWeight:"bold",textTransform:"capitalize",textDecoration:"none"}).html(a.section+" ("+a.location+")")},o=function(a){g=a;$.get(a.href,function(b){b=$("<div/>").html(b);m.show();h.show();h.find("button").html(t(a)?"Unlike":"Like");n.html($("<a/>",{href:a.href,target:"_blank"}).html(a.title+" "+a.price)); n.append($("<div/>").html(b.find(".postingdate").html()+" in "+B(a).html()));n.append($("<div/>").html(b.find(".returnemail").html()));h.css({left:$(window).width()/2-325,top:$(window).scrollTop()+20});u.html(b.find("#userbody").html())});return!1};y(C)})();